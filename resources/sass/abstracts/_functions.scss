// =============================================================================
// Functions Utilitaires - Projet Schoola
// Collection de fonctions SCSS pour faciliter les calculs et conversions
// =============================================================================

// =============================================================================
// COULEURS
// =============================================================================

/// Convertit une couleur en format rgba avec opacité
/// @param {Color} $color - Couleur de base
/// @param {Number} $opacity - Opacité (0-1)
/// @return {Color} - Couleur rgba
@function rgba-color($color, $opacity) {
    @return rgba($color, $opacity);
}

/// Augmente la luminosité d'une couleur
/// @param {Color} $color - Couleur de base
/// @param {Number} $amount - Pourcentage d'éclaircissement
/// @return {Color} - Couleur éclaircie
@function tint($color, $amount) {
    @return mix(white, $color, $amount);
}

/// Diminue la luminosité d'une couleur
/// @param {Color} $color - Couleur de base
/// @param {Number} $amount - Pourcentage d'assombrissement
/// @return {Color} - Couleur assombrie
@function shade($color, $amount) {
    @return mix(black, $color, $amount);
}

// =============================================================================
// UNITS
// =============================================================================

/// Convertit pixels en rem
/// @param {Number} $pixels - Valeur en pixels
/// @param {Number} $base - Taille de base en pixels (16px par défaut)
/// @return {Number} - Valeur en rem
@function rem($pixels, $base: 16) {
    @return #{$pixels / $base}rem;
}

/// Convertit pixels en em
/// @param {Number} $pixels - Valeur en pixels
/// @param {Number} $base - Taille de base en pixels (16px par défaut)
/// @return {Number} - Valeur en em
@function em($pixels, $base: 16) {
    @return #{$pixels / $base}em;
}

/// Retire l'unité d'une valeur
/// @param {Number} $value - Valeur avec unité
/// @return {Number} - Valeur sans unité
@function strip-unit($value) {
    @return $value / ($value * 0 + 1);
}

// =============================================================================
// SPACING
// =============================================================================

/// Obtient une valeur de spacing depuis l'échelle
/// @param {Number} $scale - Index de l'échelle (1-10)
/// @return {String} - Variable CSS du spacing
@function spacing($scale) {
    @return var(--space-#{$scale});
}

/// Multiplie un spacing de base
/// @param {Number} $multiplier - Multiplicateur
/// @param {Number} $base - Valeur de base (1rem par défaut)
/// @return {Number} - Valeur calculée
@function space($multiplier, $base: 1rem) {
    @return $multiplier * $base;
}

// =============================================================================
// STRINGS
// =============================================================================

/// Remplace une sous-chaîne dans une chaîne
/// @param {String} $string - Chaîne de base
/// @param {String} $search - Sous-chaîne à chercher
/// @param {String} $replace - Sous-chaîne de remplacement
/// @return {String} - Chaîne modifiée
@function str-replace($string, $search, $replace: '') {
    $index: str-index($string, $search);

    @if $index {
        @return str-slice($string, 1, $index - 1) + $replace + str-replace(str-slice($string, $index + str-length($search)), $search, $replace);
    }

    @return $string;
}

/// Capitalise la première lettre d'une chaîne
/// @param {String} $string - Chaîne à capitaliser
/// @return {String} - Chaîne capitalisée
@function capitalize($string) {
    @return to-upper-case(str-slice($string, 1, 1)) + str-slice($string, 2);
}

// =============================================================================
// MATH
// =============================================================================

/// Calcule la puissance d'un nombre
/// @param {Number} $base - Base
/// @param {Number} $exponent - Exposant
/// @return {Number} - Résultat
@function pow($base, $exponent) {
    $result: 1;

    @if $exponent > 0 {
        @for $i from 1 through $exponent {
            $result: $result * $base;
        }
    } @else if $exponent < 0 {
        @for $i from -1 through $exponent {
            $result: $result / $base;
        }
    }

    @return $result;
}

/// Arrondit un nombre au nombre de décimales spécifié
/// @param {Number} $number - Nombre à arrondir
/// @param {Number} $decimals - Nombre de décimales
/// @return {Number} - Nombre arrondi
@function decimal-round($number, $decimals: 2) {
    $multiplier: pow(10, $decimals);
    @return round($number * $multiplier) / $multiplier;
}

/// Clamp une valeur entre min et max
/// @param {Number} $value - Valeur à clamp
/// @param {Number} $min - Valeur minimum
/// @param {Number} $max - Valeur maximum
/// @return {Number} - Valeur clampée
@function clamp-value($value, $min, $max) {
    @return max($min, min($value, $max));
}

// =============================================================================
// MAPS
// =============================================================================

/// Récupère une valeur profonde dans une map
/// @param {Map} $map - Map à parcourir
/// @param {List} $keys - Liste des clés
/// @return {*} - Valeur trouvée
@function map-deep-get($map, $keys...) {
    @each $key in $keys {
        $map: map-get($map, $key);
    }
    @return $map;
}

/// Vérifie si une clé existe dans une map
/// @param {Map} $map - Map à vérifier
/// @param {String} $key - Clé à chercher
/// @return {Boolean} - true si la clé existe
@function map-has-key-deep($map, $keys...) {
    @each $key in $keys {
        @if not map-has-key($map, $key) {
            @return false;
        }
        $map: map-get($map, $key);
    }
    @return true;
}

// =============================================================================
// CONTRASTE
// =============================================================================

/// Détermine si une couleur est claire ou sombre
/// @param {Color} $color - Couleur à tester
/// @return {Boolean} - true si la couleur est claire
@function is-light($color) {
    @return lightness($color) > 50%;
}

/// Retourne une couleur contrastante (noir ou blanc)
/// @param {Color} $color - Couleur de base
/// @param {Color} $light - Couleur claire (blanc par défaut)
/// @param {Color} $dark - Couleur sombre (noir par défaut)
/// @return {Color} - Couleur contrastante
@function contrast-color($color, $light: #ffffff, $dark: #000000) {
    @if is-light($color) {
        @return $dark;
    } @else {
        @return $light;
    }
}

// =============================================================================
// BREAKPOINTS
// =============================================================================

/// Récupère la valeur d'un breakpoint
/// @param {String} $name - Nom du breakpoint
/// @return {Number} - Valeur du breakpoint
@function breakpoint($name) {
    $breakpoints: (
        xs: 0,
        sm: 576px,
        md: 768px,
        lg: 992px,
        xl: 1200px,
        xxl: 1400px
    );

    @if map-has-key($breakpoints, $name) {
        @return map-get($breakpoints, $name);
    } @else {
        @warn "Breakpoint `#{$name}` not found. Available: #{map-keys($breakpoints)}";
        @return null;
    }
}

/// Calcule le breakpoint minimum
/// @param {String} $name - Nom du breakpoint
/// @return {Number|null} - Valeur minimum ou null
@function breakpoint-min($name) {
    $value: breakpoint($name);
    @return if($value != 0, $value, null);
}

/// Calcule le breakpoint maximum
/// @param {String} $name - Nom du breakpoint
/// @return {Number|null} - Valeur maximum ou null
@function breakpoint-max($name) {
    $breakpoints: (xs, sm, md, lg, xl, xxl);
    $index: index($breakpoints, $name);

    @if $index and $index < length($breakpoints) {
        $next: nth($breakpoints, $index + 1);
        @return breakpoint($next) - 0.02px;
    } @else {
        @return null;
    }
}

// =============================================================================
// Z-INDEX
// =============================================================================

/// Récupère un niveau de z-index depuis la scale
/// @param {String} $level - Nom du niveau (dropdown, modal, etc.)
/// @return {Number} - Valeur du z-index
@function z-index($level) {
    $z-indexes: (
        base: 0,
        dropdown: 1000,
        sticky: 1020,
        fixed: 1030,
        modal-backdrop: 1040,
        modal: 1050,
        popover: 1060,
        tooltip: 1070
    );

    @if map-has-key($z-indexes, $level) {
        @return map-get($z-indexes, $level);
    } @else {
        @warn "Z-index level `#{$level}` not found. Available: #{map-keys($z-indexes)}";
        @return 0;
    }
}

// =============================================================================
// TIMING
// =============================================================================

/// Récupère une fonction de timing
/// @param {String} $name - Nom de la fonction
/// @return {String} - Fonction de timing CSS
@function timing($name) {
    $timings: (
        linear: linear,
        ease: ease,
        ease-in: ease-in,
        ease-out: ease-out,
        ease-in-out: ease-in-out,
        ease-in-quad: cubic-bezier(0.55, 0.085, 0.68, 0.53),
        ease-in-cubic: cubic-bezier(0.55, 0.055, 0.675, 0.19),
        ease-out-quad: cubic-bezier(0.25, 0.46, 0.45, 0.94),
        ease-out-cubic: cubic-bezier(0.215, 0.61, 0.355, 1),
        ease-in-out-quad: cubic-bezier(0.455, 0.03, 0.515, 0.955),
        ease-in-out-cubic: cubic-bezier(0.645, 0.045, 0.355, 1)
    );

    @if map-has-key($timings, $name) {
        @return map-get($timings, $name);
    } @else {
        @warn "Timing function `#{$name}` not found. Available: #{map-keys($timings)}";
        @return ease;
    }
}

// =============================================================================
// VALIDATION
// =============================================================================

/// Valide si une valeur est un nombre
/// @param {*} $value - Valeur à tester
/// @return {Boolean} - true si c'est un nombre
@function is-number($value) {
    @return type-of($value) == 'number';
}

/// Valide si une valeur est une couleur
/// @param {*} $value - Valeur à tester
/// @return {Boolean} - true si c'est une couleur
@function is-color($value) {
    @return type-of($value) == 'color';
}

/// Valide si une valeur est une liste
/// @param {*} $value - Valeur à tester
/// @return {Boolean} - true si c'est une liste
@function is-list($value) {
    @return type-of($value) == 'list';
}
