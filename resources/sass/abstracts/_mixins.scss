// =============================================================================
// Mixins Réutilisables - Projet Schoola
// Collection de mixins pour standardiser le code et améliorer la maintenabilité
// =============================================================================

// =============================================================================
// FOCUS STATES
// =============================================================================

/// Focus ring pour l'accessibilité clavier
/// @param {Color} $color - Couleur du focus ring
/// @param {Number} $width - Largeur de l'outline
/// @param {Number} $offset - Décalage de l'outline
@mixin focus-ring($color: var(--color-primary), $width: 3px, $offset: 2px) {
    outline: $width solid $color;
    outline-offset: $offset;
    box-shadow: 0 0 0 4px rgba($color, 0.2);
}

/// Focus visible moderne (seulement pour navigation clavier)
@mixin focus-visible($color: var(--color-primary)) {
    &:focus {
        outline: none;
    }

    &:focus-visible {
        @include focus-ring($color);
    }
}

// =============================================================================
// CARDS
// =============================================================================

/// Style de base pour les cartes
/// @param {Color} $bg - Couleur de fond
/// @param {String} $shadow - Ombre de la carte
@mixin card-base($bg: var(--card-bg), $shadow: var(--shadow-md)) {
    background-color: $bg;
    border: none;
    border-radius: var(--radius-lg);
    box-shadow: $shadow;
    transition: box-shadow var(--transition-base);
    color: var(--text-primary); // Assure que le texte est lisible

    &:hover {
        box-shadow: var(--card-hover-shadow);
    }

    // Assurer que les éléments enfants héritent de la bonne couleur
    .card-header,
    .card-body,
    .card-footer {
        color: var(--text-primary);
    }

    // Ne pas affecter les headers avec background de couleur
    .card-header {
        &.bg-primary,
        &.bg-secondary,
        &.bg-success,
        &.bg-danger,
        &.bg-warning,
        &.bg-info,
        &.bg-dark,
        &.text-white {
            color: inherit;
        }
    }
}

/// Carte avec effet de survol animé
@mixin card-hoverable($translate-y: -4px) {
    cursor: pointer;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);

    &:hover {
        transform: translateY($translate-y);
        box-shadow: var(--shadow-xl);
    }
}

/// Carte avec dégradé de fond
/// @param {Color} $start - Couleur de début du gradient
/// @param {Color} $end - Couleur de fin du gradient
@mixin card-gradient($start, $end) {
    background: linear-gradient(135deg, $start 0%, $end 100%);
    color: var(--text-white);
    border: none;

    * {
        color: var(--text-white);
    }
}

// =============================================================================
// RESPONSIVE BREAKPOINTS
// =============================================================================

/// Media query responsive simplifiée
/// @param {String} $breakpoint - Nom du breakpoint
@mixin respond-to($breakpoint) {
    @if $breakpoint == 'xs' {
        @media (max-width: 575px) { @content; }
    }
    @else if $breakpoint == 'sm' {
        @media (min-width: 576px) { @content; }
    }
    @else if $breakpoint == 'md' {
        @media (min-width: 768px) { @content; }
    }
    @else if $breakpoint == 'lg' {
        @media (min-width: 992px) { @content; }
    }
    @else if $breakpoint == 'xl' {
        @media (min-width: 1200px) { @content; }
    }
    @else if $breakpoint == 'xxl' {
        @media (min-width: 1400px) { @content; }
    }
}

/// Media query pour max-width
/// @param {String} $breakpoint - Nom du breakpoint
@mixin respond-below($breakpoint) {
    @if $breakpoint == 'sm' {
        @media (max-width: 575px) { @content; }
    }
    @else if $breakpoint == 'md' {
        @media (max-width: 767px) { @content; }
    }
    @else if $breakpoint == 'lg' {
        @media (max-width: 991px) { @content; }
    }
    @else if $breakpoint == 'xl' {
        @media (max-width: 1199px) { @content; }
    }
    @else if $breakpoint == 'xxl' {
        @media (max-width: 1399px) { @content; }
    }
}

/// Media query pour plage de breakpoints
/// @param {String} $min - Breakpoint minimum
/// @param {String} $max - Breakpoint maximum
@mixin respond-between($min, $max) {
    @media (min-width: $min) and (max-width: $max) { @content; }
}

// =============================================================================
// DARK MODE
// =============================================================================

/// Applique des styles pour le mode sombre
@mixin dark-mode {
    @media (prefers-color-scheme: dark) {
        @content;
    }

    [data-bs-theme="dark"] & {
        @content;
    }
}

/// Applique des styles UNIQUEMENT pour le mode clair
@mixin light-mode {
    @media (prefers-color-scheme: light) {
        @content;
    }

    [data-bs-theme="light"] & {
        @content;
    }
}

// =============================================================================
// TEXT UTILITIES
// =============================================================================

/// Tronque le texte avec ellipsis
/// @param {Number} $lines - Nombre de lignes avant troncature (1 par défaut)
@mixin truncate($lines: 1) {
    @if $lines == 1 {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    } @else {
        display: -webkit-box;
        -webkit-line-clamp: $lines;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
}

/// Texte responsive qui s'adapte à la taille d'écran
/// @param {Number} $min-size - Taille minimum
/// @param {Number} $max-size - Taille maximum
@mixin fluid-type($min-size, $max-size) {
    font-size: clamp($min-size, calc(#{$min-size} + (#{$max-size} - #{$min-size}) * ((100vw - 320px) / (1920 - 320))), $max-size);
}

// =============================================================================
// FLEXBOX UTILITIES
// =============================================================================

/// Centrage flex rapide (horizontal et vertical)
@mixin flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

/// Flex row avec alignement personnalisé
/// @param {String} $align - align-items
/// @param {String} $justify - justify-content
@mixin flex-row($align: center, $justify: flex-start) {
    display: flex;
    flex-direction: row;
    align-items: $align;
    justify-content: $justify;
}

/// Flex column avec alignement personnalisé
/// @param {String} $align - align-items
/// @param {String} $justify - justify-content
@mixin flex-column($align: flex-start, $justify: flex-start) {
    display: flex;
    flex-direction: column;
    align-items: $align;
    justify-content: $justify;
}

// =============================================================================
// POSITION UTILITIES
// =============================================================================

/// Position absolute centrage
@mixin absolute-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/// Position absolute avec coordonnées
/// @param {Number} $top - Position top
/// @param {Number} $right - Position right
/// @param {Number} $bottom - Position bottom
/// @param {Number} $left - Position left
@mixin absolute($top: null, $right: null, $bottom: null, $left: null) {
    position: absolute;
    @if $top { top: $top; }
    @if $right { right: $right; }
    @if $bottom { bottom: $bottom; }
    @if $left { left: $left; }
}

/// Position fixed avec coordonnées
@mixin fixed($top: null, $right: null, $bottom: null, $left: null) {
    position: fixed;
    @if $top { top: $top; }
    @if $right { right: $right; }
    @if $bottom { bottom: $bottom; }
    @if $left { left: $left; }
}

// =============================================================================
// SIZE UTILITIES
// =============================================================================

/// Définit width et height en une seule ligne
/// @param {Number} $width - Largeur
/// @param {Number} $height - Hauteur (optionnel, prend $width par défaut)
@mixin size($width, $height: $width) {
    width: $width;
    height: $height;
}

/// Cercle parfait
/// @param {Number} $size - Diamètre du cercle
@mixin circle($size) {
    @include size($size);
    border-radius: 50%;
}

// =============================================================================
// ACCESSIBILITY
// =============================================================================

/// Cache visuellement mais reste accessible aux lecteurs d'écran
@mixin visually-hidden {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

/// Réinitialise visually-hidden au focus
@mixin visually-hidden-focusable {
    &:active,
    &:focus {
        position: static !important;
        width: auto !important;
        height: auto !important;
        overflow: visible !important;
        clip: auto !important;
        white-space: normal !important;
    }
}

// =============================================================================
// BUTTONS
// =============================================================================

/// Bouton de base avec styles cohérents
/// @param {Color} $bg - Couleur de fond
/// @param {Color} $color - Couleur du texte
/// @param {Color} $hover-bg - Couleur de fond au survol
@mixin button-base($bg, $color, $hover-bg: null) {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--btn-padding-y) var(--btn-padding-x);
    font-size: var(--btn-font-size);
    font-weight: var(--font-weight-semibold);
    line-height: var(--line-height-base);
    color: $color;
    background-color: $bg;
    border: 1px solid $bg;
    border-radius: var(--btn-border-radius);
    cursor: pointer;
    transition: all var(--transition-fast);
    text-decoration: none;

    &:hover {
        background-color: $hover-bg or darken($bg, 10%);
        border-color: $hover-bg or darken($bg, 10%);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    &:active {
        transform: translateY(0);
    }

    &:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none;
    }
}

// =============================================================================
// ANIMATIONS
// =============================================================================

/// Fade in animation
/// @param {Number} $duration - Durée de l'animation
@mixin fade-in($duration: var(--transition-base)) {
    animation: fadeIn $duration ease-in-out;

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
}

/// Slide in animation
/// @param {String} $direction - Direction (up, down, left, right)
/// @param {Number} $distance - Distance du slide
@mixin slide-in($direction: up, $distance: 20px, $duration: var(--transition-base)) {
    animation: slideIn#{capitalize($direction)} $duration ease-out;

    @if $direction == up {
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY($distance);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    }
    @else if $direction == down {
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-$distance);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    }
    @else if $direction == left {
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX($distance);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    }
    @else if $direction == right {
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-$distance);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    }
}

// =============================================================================
// SCROLLBAR
// =============================================================================

/// Scrollbar personnalisée
/// @param {Number} $width - Largeur de la scrollbar
/// @param {Color} $track-color - Couleur du track
/// @param {Color} $thumb-color - Couleur du thumb
@mixin custom-scrollbar($width: 8px, $track-color: null, $thumb-color: null) {
    &::-webkit-scrollbar {
        width: $width;
        height: $width;
    }

    &::-webkit-scrollbar-track {
        @if $track-color {
            background: $track-color;
        } @else {
            background: var(--bg-secondary);
        }
        border-radius: calc($width / 2);
    }

    &::-webkit-scrollbar-thumb {
        @if $thumb-color {
            background: $thumb-color;
        } @else {
            background: var(--border-color);
        }
        border-radius: calc($width / 2);
        transition: background var(--transition-fast);

        &:hover {
            background: var(--text-muted);
        }
    }
}

// =============================================================================
// TRANSITIONS
// =============================================================================

/// Transition pour propriétés multiples
/// @param {List} $properties - Liste des propriétés à animer
/// @param {Number} $duration - Durée
/// @param {String} $timing - Fonction de timing
@mixin transition($properties, $duration: var(--transition-base), $timing: ease-in-out) {
    $transitions: ();
    @each $property in $properties {
        $transitions: append($transitions, $property $duration $timing, comma);
    }
    transition: $transitions;
}

// =============================================================================
// FORM CONTROLS
// =============================================================================

/// Style de base pour les inputs
@mixin input-base {
    display: block;
    width: 100%;
    padding: var(--space-2) var(--space-3);
    font-size: var(--font-size-base);
    line-height: var(--line-height-base);
    color: var(--input-text);
    background-color: var(--input-bg);
    border: 1px solid var(--input-border);
    border-radius: var(--radius-base);
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);

    &::placeholder {
        color: var(--input-placeholder);
    }

    &:focus {
        border-color: var(--input-focus-border);
        outline: none;
        box-shadow: 0 0 0 0.25rem var(--input-focus-shadow);
    }

    &:disabled {
        background-color: var(--input-disabled-bg);
        opacity: 0.7;
        cursor: not-allowed;
    }
}

// =============================================================================
// PRINT
// =============================================================================

/// Styles spécifiques à l'impression
@mixin print-only {
    @media print {
        @content;
    }
}

/// Masque à l'impression
@mixin print-hidden {
    @media print {
        display: none !important;
    }
}
