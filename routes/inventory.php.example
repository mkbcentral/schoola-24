<?php

/**
 * Routes du Domaine Inventaire
 *
 * Gestion du stock et des articles
 *
 * ⚠️ IMPORTANT: Toutes ces routes nécessitent le middleware 'stock.guard'
 */

use App\Http\Controllers\StockExportController;
use App\Livewire\Application\Stock\ArticleCategoryManager;
use App\Livewire\Application\Stock\ArticleInventoryManager;
use App\Livewire\Application\Stock\ArticleStockManager;
use App\Livewire\Application\Stock\ArticleStockMovementManager;
use App\Livewire\Application\Stock\AuditHistoryViewer;
use App\Livewire\Application\Stock\StockDashboard;
use Illuminate\Support\Facades\Route;

/**
 * Routes protégées par auth + stock.guard
 */
Route::middleware(['auth', 'verified', 'stock.guard'])
    ->prefix('stock')
    ->name('stock.')
    ->group(function () {

    // ============================================================
    // DASHBOARD STOCK
    // ============================================================
    Route::get('dashboard', StockDashboard::class)
        ->name('dashboard')
        ->lazy();

    // ============================================================
    // GESTION DES ARTICLES
    // ============================================================
    Route::get('catalog', ArticleStockManager::class)
        ->name('main')
        ->lazy();

    Route::get('categories', ArticleCategoryManager::class)
        ->name('categories')
        ->lazy();

    Route::get('inventory', ArticleInventoryManager::class)
        ->name('inventory')
        ->lazy();

    // ============================================================
    // MOUVEMENTS DE STOCK
    // ============================================================
    Route::get('movements/{article}', ArticleStockMovementManager::class)
        ->name('movements')
        ->lazy();

    Route::get('export/movements-pdf/{article}', [StockExportController::class, 'exportMovementsPdf'])
        ->name('export.movements.pdf');

    // ============================================================
    // AUDIT ET HISTORIQUE
    // ============================================================
    Route::get('audit', AuditHistoryViewer::class)
        ->name('audit')
        ->lazy();

    Route::get('audit/{articleId}', AuditHistoryViewer::class)
        ->name('audit.article')
        ->lazy();
});
